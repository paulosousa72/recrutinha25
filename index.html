<!DOCTYPE html>
<html>
<head>
    <title>AR com Babylon.js - Depuração</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { width: 100%; height: 100%; }
    </style>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        const canvas = document.getElementById("renderCanvas");
        const engine = new BABYLON.Engine(canvas, true);

        const createScene = async function () {
            const scene = new BABYLON.Scene(engine);
            const camera = new BABYLON.FreeCamera("camera1", new BABYLON.Vector3(0, 1, -5), scene);
            camera.setTarget(BABYLON.Vector3.Zero());
            const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);

            // Carrega o modelo e adiciona logs
            console.log("Tentando carregar o modelo...");
            try {
                const result = await BABYLON.SceneLoader.ImportMeshAsync("", "https://models.babylonjs.com/", "BoomBox.glb", scene);
                const character = result.meshes[0];
                character.scaling = new BABYLON.Vector3(0.05, 0.05, 0.05);
                character.position = new BABYLON.Vector3(0, 0, 0); // Posição fixa para teste
                console.log("Modelo carregado com sucesso!");
            } catch (error) {
                console.error("Erro ao carregar o modelo:", error);
            }

            // Configura WebXR
            console.log("Configurando WebXR...");
            const xr = await scene.createDefaultXRExperienceAsync({
                floorMeshes: []
            });

            if (!xr.baseExperience) {
                alert("WebXR não é suportado neste dispositivo/navegador.");
                console.log("WebXR não suportado.");
                return scene;
            }

            // Ativa HitTest
            xr.baseExperience.featuresManager.enableFeature(BABYLON.WebXRHitTest, "latest", {
                onHitTestResultObservable: (results) => {
                    if (results.length > 0) {
                        const hit = results[0];
                        character.position = hit.position;
                        console.log("Superfície detectada, posicionando modelo em:", hit.position);
                    } else {
                        console.log("Nenhuma superfície detectada ainda...");
                    }
                }
            });

            // Entra no modo AR
            xr.baseExperience.enterXRAsync("immersive-ar", "local-floor").then(() => {
                console.log("Entrou no modo AR com sucesso!");
            }).catch((err) => {
                console.error("Erro ao entrar no AR:", err);
            });

            return scene;
        };

        createScene().then(scene => {
            engine.runRenderLoop(() => {
                scene.render();
            });
        });

        window.addEventListener("resize", () => {
            engine.resize();
        });
    </script>
</body>
</html>
